"use strict";(self.webpackChunksupastash_docs=self.webpackChunksupastash_docs||[]).push([[7666],{5180:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"sync-log-utils","title":"\ud83d\udcda Sync Log Utilities","description":"Supastash tracks createdat, updatedat, and deleted_at checkpoints per table and per filter key.","source":"@site/docs/sync-log-utils.md","sourceDirName":".","slug":"/sync-log-utils","permalink":"/supastash/docs/sync-log-utils","draft":false,"unlisted":false,"editUrl":"https://github.com/0xZekeA/supastash/tree/main/docs-site/docs/sync-log-utils.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Destructive Operations","permalink":"/supastash/docs/destructives"},"next":{"title":"\ud83d\udd04 Manual Refresh","permalink":"/supastash/docs/manual-refreshes"}}');var l=n(4848),r=n(8453);const a={},i="\ud83d\udcda Sync Log Utilities",c={},d=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Sync Cursor Model (Important)",id:"sync-cursor-model-important",level:2},{value:"<code>updated_at</code>",id:"updated_at",level:3},{value:"<code>created_at</code>",id:"created_at",level:3},{value:"<code>deleted_at</code>",id:"deleted_at",level:3},{value:"Functions",id:"functions",level:2},{value:"\ud83e\uddf9 <code>clearLocalSyncLog(tableName: string)</code>",id:"-clearlocalsynclogtablename-string",level:3},{value:"\ud83d\udd04 <code>clearAllLocalSyncLog()</code>",id:"-clearalllocalsynclog",level:3},{value:"\ud83d\udce5 <code>getSyncLog(tableName: string)</code>",id:"-getsynclogtablename-string",level:3},{value:"\u270d\ufe0f <code>setSyncLog(table: string, filters: SupastashFilter[] | undefined, opts)</code>",id:"\ufe0f-setsynclogtable-string-filters-supastashfilter--undefined-opts",level:3},{value:"Options",id:"options",level:4},{value:"\ud83d\udd01 <code>resetSyncLog(table: string, filters?: SupastashFilter[], scope?: &quot;all&quot; | &quot;last_synced_at&quot; | &quot;last_deleted_at&quot;)</code>",id:"-resetsynclogtable-string-filters-supastashfilter-scope-all--last_synced_at--last_deleted_at",level:3},{value:"Scope values",id:"scope-values",level:4},{value:"\ud83d\uddd1 <code>clearSyncLog(table: string, filters?: SupastashFilter[])</code>",id:"-clearsynclogtable-string-filters-supastashfilter",level:3},{value:"Usage Notes",id:"usage-notes",level:2},{value:"Migration Guide",id:"migration-guide",level:2},{value:"Upgrading from Older Versions",id:"upgrading-from-older-versions",level:3},{value:"What Changed",id:"what-changed",level:4},{value:"Migration Steps",id:"migration-steps",level:4},{value:"Best Practices",id:"best-practices",level:2},{value:"<strong>Let Supastash manage sync logs automatically</strong>",id:"let-supastash-manage-sync-logs-automatically",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Sync appears stuck",id:"sync-appears-stuck",level:3},{value:"Data not appearing after sync",id:"data-not-appearing-after-sync",level:3},{value:"Duplicate data appearing",id:"duplicate-data-appearing",level:3},{value:"Related",id:"related",level:2},{value:"API Reference Summary",id:"api-reference-summary",level:2}];function o(e){const s={a:"a",blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.header,{children:(0,l.jsx)(s.h1,{id:"-sync-log-utilities",children:"\ud83d\udcda Sync Log Utilities"})}),"\n",(0,l.jsxs)(s.p,{children:["Supastash tracks ",(0,l.jsx)(s.code,{children:"created_at"}),", ",(0,l.jsx)(s.code,{children:"updated_at"}),", and ",(0,l.jsx)(s.code,{children:"deleted_at"})," checkpoints per table and per filter key."]}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsxs)(s.strong,{children:["Starting from newer releases, Supastash uses ",(0,l.jsx)(s.code,{children:"updated_at"})," as the primary sync cursor."]}),(0,l.jsx)(s.br,{}),"\n","This shift was introduced to ",(0,l.jsx)(s.strong,{children:"enhance performance, reduce redundant network calls, and simplify sync logic"}),", while preserving backward compatibility."]}),"\n",(0,l.jsxs)(s.blockquote,{children:["\n",(0,l.jsxs)(s.p,{children:["\ud83d\udca1 ",(0,l.jsx)(s.code,{children:"updated_at"})," is now the ",(0,l.jsx)(s.strong,{children:"authoritative cursor"})," used during sync operations.",(0,l.jsx)(s.br,{}),"\n",(0,l.jsx)(s.code,{children:"created_at"})," and ",(0,l.jsx)(s.code,{children:"deleted_at"})," are retained for ",(0,l.jsx)(s.strong,{children:"metadata, inspection, analytics, and legacy consumers"}),"."]}),"\n"]}),"\n",(0,l.jsxs)(s.p,{children:["Legacy helpers such as ",(0,l.jsx)(s.code,{children:"setLocalSyncLog"})," / ",(0,l.jsx)(s.code,{children:"setLocalDeleteLog"})," are ",(0,l.jsx)(s.strong,{children:"deprecated"}),"."]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.a,{href:"#sync-cursor-model-important",children:"Sync Cursor Model"})}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.a,{href:"#functions",children:"Functions"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.a,{href:"#-clearlocalsynclogtablename-string",children:"clearLocalSyncLog"})}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.a,{href:"#-clearalllocalsynclog",children:"clearAllLocalSyncLog"})}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.a,{href:"#-getsynclogtablename-string",children:"getSyncLog"})}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.a,{href:"#-setsynclogtable-string-filters-SupastashFilter--undefined-opts",children:"setSyncLog"})}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.a,{href:"#-resetsynclogtable-string-filters-SupastashFilter-scope-all--last_synced_at--last_deleted_at",children:"resetSyncLog"})}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.a,{href:"#-clearsynclogtable-string-filters-SupastashFilter",children:"clearSyncLog"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.a,{href:"#usage-notes",children:"Usage Notes"})}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.a,{href:"#migration-guide",children:"Migration Guide"})}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.a,{href:"#best-practices",children:"Best Practices"})}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.a,{href:"#related",children:"Related Documentation"})}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"sync-cursor-model-important",children:"Sync Cursor Model (Important)"}),"\n",(0,l.jsx)(s.p,{children:"Supastash follows this internal model:"}),"\n",(0,l.jsx)(s.h3,{id:"updated_at",children:(0,l.jsx)(s.code,{children:"updated_at"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["The single ",(0,l.jsx)(s.strong,{children:"authoritative sync cursor"})]}),"\n",(0,l.jsx)(s.li,{children:"Used to determine which rows are pulled from the server"}),"\n",(0,l.jsxs)(s.li,{children:["Drives ",(0,l.jsx)(s.code,{children:"last_synced_at"})]}),"\n",(0,l.jsxs)(s.li,{children:["Used together with the row primary key (",(0,l.jsx)(s.code,{children:"id"}),") as a compound cursor"]}),"\n",(0,l.jsxs)(s.li,{children:["Internally tracked as (",(0,l.jsx)(s.code,{children:"last_synced_at"}),", ",(0,l.jsx)(s.code,{children:"last_synced_at_pk"}),") to ensure stable paging"]}),"\n",(0,l.jsxs)(s.li,{children:["Guaranteed to update on ",(0,l.jsx)(s.strong,{children:"every mutation"})," (create, update, soft-delete)"]}),"\n"]}),"\n",(0,l.jsxs)(s.blockquote,{children:["\n",(0,l.jsxs)(s.p,{children:["\ud83d\udca1 Supastash uses a ",(0,l.jsx)(s.strong,{children:"compound cursor"})," internally:\n(",(0,l.jsx)(s.code,{children:"updated_at"}),", ",(0,l.jsx)(s.code,{children:"id"}),")"]}),"\n",(0,l.jsxs)(s.p,{children:["This guarantees correct pagination when multiple rows share the same ",(0,l.jsx)(s.code,{children:"updated_at"})," timestamp."]}),"\n"]}),"\n",(0,l.jsx)(s.h3,{id:"created_at",children:(0,l.jsx)(s.code,{children:"created_at"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Preserved for metadata and legacy use"}),"\n",(0,l.jsx)(s.li,{children:"Not used to determine sync boundaries"}),"\n",(0,l.jsx)(s.li,{children:"Useful for analytics and audit trails"}),"\n"]}),"\n",(0,l.jsx)(s.h3,{id:"deleted_at",children:(0,l.jsx)(s.code,{children:"deleted_at"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Used to represent soft-deletes"}),"\n",(0,l.jsx)(s.li,{children:"Informational only"}),"\n",(0,l.jsx)(s.li,{children:"Does not advance the sync cursor independently"}),"\n"]}),"\n",(0,l.jsxs)(s.blockquote,{children:["\n",(0,l.jsxs)(s.p,{children:["\u26a0\ufe0f ",(0,l.jsx)(s.strong,{children:"Important:"})," Even though all three timestamps are tracked, ",(0,l.jsxs)(s.strong,{children:["only ",(0,l.jsx)(s.code,{children:"updated_at"})," affects sync progression"]}),"."]}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"functions",children:"Functions"}),"\n",(0,l.jsxs)(s.h3,{id:"-clearlocalsynclogtablename-string",children:["\ud83e\uddf9 ",(0,l.jsx)(s.code,{children:"clearLocalSyncLog(tableName: string)"})]}),"\n",(0,l.jsx)(s.p,{children:"Clears the stored sync log for a single table."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Usage:"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:'await clearLocalSyncLog("users");\n'})}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"When to use:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"When you want to force a full resync of a specific table"}),"\n",(0,l.jsx)(s.li,{children:"During development/testing"}),"\n",(0,l.jsx)(s.li,{children:"When recovering from sync errors"}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsxs)(s.h3,{id:"-clearalllocalsynclog",children:["\ud83d\udd04 ",(0,l.jsx)(s.code,{children:"clearAllLocalSyncLog()"})]}),"\n",(0,l.jsx)(s.p,{children:"Drops the entire sync-status table and recreates it."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Usage:"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:"await clearAllLocalSyncLog();\n"})}),"\n",(0,l.jsxs)(s.blockquote,{children:["\n",(0,l.jsxs)(s.p,{children:["\u26a0\ufe0f ",(0,l.jsx)(s.strong,{children:"Warning:"})," This removes sync checkpoints for ",(0,l.jsx)(s.strong,{children:"all tables"}),". Use with caution in production environments."]}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"When to use:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Complete application reset"}),"\n",(0,l.jsx)(s.li,{children:"Major schema migrations"}),"\n",(0,l.jsx)(s.li,{children:"Testing fresh sync scenarios"}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsxs)(s.h3,{id:"-getsynclogtablename-string",children:["\ud83d\udce5 ",(0,l.jsx)(s.code,{children:"getSyncLog(tableName: string)"})]}),"\n",(0,l.jsx)(s.p,{children:"Returns the stored sync status for one table."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Usage:"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:'const log = await getSyncLog("users");\n'})}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Returns:"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:'{\n  table_name: "users",\n  last_synced_at: "2024-06-01T10:00:00.000Z",\n  last_synced_at_pk: "00000000-0000-0000-0000-000000000000"\n  last_deleted_at: "2024-06-01T10:00:00.000Z",\n  filter_key: "abc123",\n  filter_json: "[...]",\n  updated_at: "2024-06-01T10:00:00.000Z"\n}\n'})}),"\n",(0,l.jsxs)(s.p,{children:["Returns ",(0,l.jsx)(s.code,{children:"null"})," if the table has no entry."]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Use cases:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Debugging sync status"}),"\n",(0,l.jsx)(s.li,{children:"Building custom sync dashboards"}),"\n",(0,l.jsx)(s.li,{children:"Monitoring sync health"}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsxs)(s.h3,{id:"\ufe0f-setsynclogtable-string-filters-supastashfilter--undefined-opts",children:["\u270d\ufe0f ",(0,l.jsx)(s.code,{children:"setSyncLog(table: string, filters: SupastashFilter[] | undefined, opts)"})]}),"\n",(0,l.jsx)(s.p,{children:"Writes (or updates) sync metadata for a table."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Usage:"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:'await setSyncLog("users", undefined, {\n  lastSyncedAt: new Date().toISOString(),\n  lastCreatedAt: new Date().toISOString(),\n  lastDeletedAt: null, // optional\n});\n'})}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"With filters:"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:'await setSyncLog("posts", [{ column: "user_id", value: "123" }], {\n  lastSyncedAt: new Date().toISOString(),\n  lastCreatedAt: new Date().toISOString(),\n  filterNamespace: "user_posts",\n});\n'})}),"\n",(0,l.jsx)(s.h4,{id:"options",children:"Options"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{children:"Field"}),(0,l.jsx)(s.th,{children:"Type"}),(0,l.jsx)(s.th,{children:"Required"}),(0,l.jsx)(s.th,{children:"Description"})]})}),(0,l.jsxs)(s.tbody,{children:[(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.code,{children:"lastSyncedAt"})}),(0,l.jsx)(s.td,{children:(0,l.jsx)(s.code,{children:"string"})}),(0,l.jsx)(s.td,{children:"Yes"}),(0,l.jsxs)(s.td,{children:["Highest ",(0,l.jsx)(s.code,{children:"updated_at"})," pulled for this table (authoritative)."]})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.code,{children:"last_synced_at_pk"})}),(0,l.jsx)(s.td,{children:(0,l.jsx)(s.code,{children:"string"})}),(0,l.jsx)(s.td,{children:"Yes"}),(0,l.jsxs)(s.td,{children:["Highest ",(0,l.jsx)(s.code,{children:"id"})," pulled for this table (authoritative)."]})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.code,{children:"lastCreatedAt"})}),(0,l.jsx)(s.td,{children:(0,l.jsx)(s.code,{children:"string"})}),(0,l.jsx)(s.td,{children:"Yes"}),(0,l.jsxs)(s.td,{children:["Highest ",(0,l.jsx)(s.code,{children:"created_at"})," observed (informational)."]})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.code,{children:"lastDeletedAt"})}),(0,l.jsx)(s.td,{children:(0,l.jsx)(s.code,{children:"string | null"})}),(0,l.jsx)(s.td,{children:"No"}),(0,l.jsxs)(s.td,{children:["Highest ",(0,l.jsx)(s.code,{children:"deleted_at"})," observed for soft-deletes."]})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.code,{children:"filterNamespace"})}),(0,l.jsx)(s.td,{children:(0,l.jsx)(s.code,{children:"string"})}),(0,l.jsx)(s.td,{children:"No"}),(0,l.jsx)(s.td,{children:"Optional namespace to separate different filter sets."})]})]})]}),"\n",(0,l.jsx)(s.p,{children:"When filters are supplied, a filter key is computed and stored alongside the timestamps."}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsxs)(s.h3,{id:"-resetsynclogtable-string-filters-supastashfilter-scope-all--last_synced_at--last_deleted_at",children:["\ud83d\udd01 ",(0,l.jsx)(s.code,{children:'resetSyncLog(table: string, filters?: SupastashFilter[], scope?: "all" | "last_synced_at" | "last_deleted_at")'})]}),"\n",(0,l.jsx)(s.p,{children:"Resets one or more timestamps for a table."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Usage examples:"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:'// Reset everything for "users"\nawait resetSyncLog("users", undefined, "all");\n\n// Only reset the sync cursor\nawait resetSyncLog("users", undefined, "last_synced_at");\n\n// Only reset deleted metadata\nawait resetSyncLog("users", undefined, "last_deleted_at");\n\n// Reset with specific filters\nawait resetSyncLog("posts", [{ column: "user_id", value: "123" }], "all");\n'})}),"\n",(0,l.jsx)(s.h4,{id:"scope-values",children:"Scope values"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{children:"Scope"}),(0,l.jsx)(s.th,{children:"Description"})]})}),(0,l.jsxs)(s.tbody,{children:[(0,l.jsxs)(s.tr,{children:[(0,l.jsxs)(s.td,{children:[(0,l.jsx)(s.code,{children:'"all"'})," (default)"]}),(0,l.jsx)(s.td,{children:"Resets created, updated, and deleted checkpoints."})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.code,{children:'"last_synced_at"'})}),(0,l.jsxs)(s.td,{children:["Resets only the authoritative ",(0,l.jsx)(s.code,{children:"updated_at"})," cursor."]})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.code,{children:'"last_synced_at_pk"'})}),(0,l.jsxs)(s.td,{children:["Resets only the authoritative ",(0,l.jsx)(s.code,{children:"id"})," cursor."]})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.code,{children:'"last_deleted_at"'})}),(0,l.jsx)(s.td,{children:"Resets only the deleted metadata."})]})]})]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"When to use:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Forcing a partial resync"}),"\n",(0,l.jsx)(s.li,{children:"Testing specific sync scenarios"}),"\n",(0,l.jsx)(s.li,{children:"Recovering from corrupted sync state"}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsxs)(s.h3,{id:"-clearsynclogtable-string-filters-supastashfilter",children:["\ud83d\uddd1 ",(0,l.jsx)(s.code,{children:"clearSyncLog(table: string, filters?: SupastashFilter[])"})]}),"\n",(0,l.jsx)(s.p,{children:"Removes the sync status row for a table and filter key."}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Usage:"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:'// Clear all sync logs for "users" table\nawait clearSyncLog("users");\n\n// Clear sync log for specific filter\nawait clearSyncLog("posts", [{ column: "user_id", value: "123" }]);\n'})}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Behavior:"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"If filters are provided, only that filter key is cleared."}),"\n",(0,l.jsx)(s.li,{children:"If no filters are provided, all sync logs for the table are removed."}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsxs)(s.strong,{children:["Difference from ",(0,l.jsx)(s.code,{children:"resetSyncLog"}),":"]})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"clearSyncLog"})," ",(0,l.jsx)(s.strong,{children:"deletes"})," the sync log entry entirely"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"resetSyncLog"})," ",(0,l.jsx)(s.strong,{children:"resets"})," timestamps to ",(0,l.jsx)(s.code,{children:"null"})," but keeps the entry"]}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"usage-notes",children:"Usage Notes"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["These helpers manage rows in the internal ",(0,l.jsx)(s.code,{children:"supastash_sync_marks"})," table."]}),"\n",(0,l.jsx)(s.li,{children:"They are safe to call manually (for testing, resets, or debugging)."}),"\n",(0,l.jsx)(s.li,{children:"In normal production flows, Supastash updates these automatically after pull and push operations."}),"\n",(0,l.jsxs)(s.li,{children:["Although multiple timestamps are tracked, sync behavior is driven ",(0,l.jsxs)(s.strong,{children:["exclusively by ",(0,l.jsx)(s.code,{children:"updated_at"})]}),"."]}),"\n",(0,l.jsxs)(s.li,{children:["Supastash resumes sync using both ",(0,l.jsx)(s.code,{children:"last_synced_at"})," and ",(0,l.jsx)(s.code,{children:"last_synced_at_pk"})," to avoid duplicate or skipped rows when timestamps collide."]}),"\n",(0,l.jsxs)(s.li,{children:["Always use ",(0,l.jsx)(s.code,{children:"setSyncLog"})," with ISO 8601 formatted timestamps."]}),"\n",(0,l.jsx)(s.li,{children:"Filter keys are automatically computed from filter arrays for consistency."}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"migration-guide",children:"Migration Guide"}),"\n",(0,l.jsx)(s.h3,{id:"upgrading-from-older-versions",children:"Upgrading from Older Versions"}),"\n",(0,l.jsxs)(s.p,{children:["If you're upgrading from an older version of Supastash that used ",(0,l.jsx)(s.code,{children:"created_at"})," as the primary cursor:"]}),"\n",(0,l.jsx)(s.h4,{id:"what-changed",children:"What Changed"}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Before (v0.1.6):"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Sync relied on separate ",(0,l.jsx)(s.code,{children:"created_at"})," and ",(0,l.jsx)(s.code,{children:"deleted_at"})," tracking"]}),"\n",(0,l.jsx)(s.li,{children:"Newly created rows were often processed more than once"}),"\n",(0,l.jsx)(s.li,{children:"Multiple cursor paths increased complexity and edge cases"}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"After (v0.1.6+):"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Sync now uses a compound (",(0,l.jsx)(s.code,{children:"updated_at"}),", ",(0,l.jsx)(s.code,{children:"id"}),") cursor internally for stable pagination"]}),"\n",(0,l.jsx)(s.li,{children:"All changes (create, update, soft-delete) advance sync uniformly"}),"\n",(0,l.jsx)(s.li,{children:"Fewer network calls, simpler logic, and improved performance"}),"\n"]}),"\n",(0,l.jsx)(s.h4,{id:"migration-steps",children:"Migration Steps"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"No immediate action required"})," - The new system is backward compatible."]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"Deprecated functions"})," - Replace these if you're using them:"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:'// \u274c Old (deprecated)\nawait setLocalSyncLog("users", new Date().toISOString());\nawait setLocalDeleteLog("users", new Date().toISOString());\n\n// \u2705 New\nawait setSyncLog("users", undefined, {\n  lastSyncedAt: new Date().toISOString(),\n  lastCreatedAt: new Date().toISOString(),\n});\n'})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"Optional: Force resync"})," - To ensure clean state:"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:'await resetSyncLog("your_table", undefined, "all");\n'})}),"\n",(0,l.jsxs)(s.blockquote,{children:["\n",(0,l.jsxs)(s.p,{children:["\u2139\ufe0f Supastash automatically updates ",(0,l.jsx)(s.code,{children:"updated_at"})," for all mutations it performs\n(creates, updates, and soft-deletes)."]}),"\n",(0,l.jsxs)(s.p,{children:["However, ",(0,l.jsx)(s.strong,{children:"database-level enforcement is still recommended"}),", especially if:"]}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"you write to the database outside of Supastash"}),"\n",(0,l.jsx)(s.li,{children:"you use SQL scripts, dashboards, or RPCs"}),"\n",(0,l.jsx)(s.li,{children:"multiple services interact with the same tables"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:"Update your database schema (recommended)"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.p,{children:["Ensure your tables have ",(0,l.jsx)(s.code,{children:"updated_at"})," triggers at the database level to guarantee consistency across ",(0,l.jsx)(s.em,{children:"all"})," writes."]}),"\n",(0,l.jsxs)(s.p,{children:["This makes it impossible for any mutation to bypass ",(0,l.jsx)(s.code,{children:"updated_at"}),", even outside Supastash."]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-sql",children:"-- Example trigger for PostgreSQL\nCREATE OR REPLACE FUNCTION update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER update_users_updated_at\nBEFORE UPDATE ON users\nFOR EACH ROW\nEXECUTE FUNCTION update_updated_at_column();\n"})}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsx)(s.h3,{id:"let-supastash-manage-sync-logs-automatically",children:(0,l.jsx)(s.strong,{children:"Let Supastash manage sync logs automatically"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Don't manually call ",(0,l.jsx)(s.code,{children:"setSyncLog"})," unless you have a specific reason"]}),"\n",(0,l.jsx)(s.li,{children:"Trust the built-in sync mechanisms"}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,l.jsx)(s.h3,{id:"sync-appears-stuck",children:"Sync appears stuck"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:'// Check current sync status\nconst status = await getSyncLog("users");\nconsole.log("Last sync:", status?.last_synced_at);\n\n// Force resync\nawait resetSyncLog("users", undefined, "last_synced_at");\n'})}),"\n",(0,l.jsx)(s.h3,{id:"data-not-appearing-after-sync",children:"Data not appearing after sync"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:'// Verify sync log exists\nconst log = await getSyncLog("users");\nif (!log) {\n  console.log("No sync log found - first sync will be full");\n}\n\n// Check for filter mismatches\nconsole.log("Current filter key:", log?.filter_key);\n'})}),"\n",(0,l.jsx)(s.h3,{id:"duplicate-data-appearing",children:"Duplicate data appearing"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:'// Clear and resync\nawait clearLocalSyncLog("users");\nawait pullData("users");\n'})}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"related",children:"Related"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.a,{href:"/supastash/docs/useSupastashSyncStatus",children:"useSupastashSyncStatus"})," - React hook for sync status"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.a,{href:"/supastash/docs/useSupastashFilters",children:"useSupastashFilters"})," - Managing sync filters"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.a,{href:"/supastash/docs/sync-flows",children:"Pulling & pushing data"})," - Complete sync guide"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.a,{href:"/supastash/docs/schema-management",children:"Schema Design"})," - Best practices for sync-friendly schemas"]}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"api-reference-summary",children:"API Reference Summary"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:'// Clear operations\nclearLocalSyncLog(tableName: string): Promise<void>\nclearAllLocalSyncLog(): Promise<void>\nclearSyncLog(table: string, filters?: SupastashFilter[]): Promise<void>\n\n// Read operations\ngetSyncLog(tableName: string): Promise<SyncLog | null>\n\n// Write operations\nsetSyncLog(\n  table: string,\n  filters: SupastashFilter[] | undefined,\n  opts: {\n    lastSyncedAt: string;\n    lastCreatedAt: string;\n    lastDeletedAt?: string | null;\n    filterNamespace?: string;\n  }\n): Promise<void>\n\n// Reset operations\nresetSyncLog(\n  table: string,\n  filters?: SupastashFilter[],\n  scope?: "all" | "last_synced_at" | "last_deleted_at"\n): Promise<void>\n'})}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"Last updated:"})," January 2025",(0,l.jsx)(s.br,{}),"\n",(0,l.jsx)(s.strong,{children:"Version:"})," 0.1.6+",(0,l.jsx)(s.br,{}),"\n",(0,l.jsx)(s.strong,{children:"Supastash Documentation"})]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>i});var t=n(6540);const l={},r=t.createContext(l);function a(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);