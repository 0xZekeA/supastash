"use strict";(self.webpackChunksupastash_docs=self.webpackChunksupastash_docs||[]).push([[1649],{957:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"getSupastashDb","title":"\ud83d\udce6 Supastash Database Adapter","description":"Supastash utilizes a pluggable SQLite adapter system to support multiple SQLite engines, including Expo SQLite, Nitro SQLite, and react-native-sqlite-storage.","source":"@site/docs/getSupastashDb.md","sourceDirName":".","slug":"/getSupastashDb","permalink":"/supastash/docs/getSupastashDb","draft":false,"unlisted":false,"editUrl":"https://github.com/0xZekeA/supastash/tree/main/docs-site/docs/getSupastashDb.md","tags":[],"version":"current","frontMatter":{}}');var i=s(4848),r=s(8453);const a={},c="\ud83d\udce6 Supastash Database Adapter",l={},d=[{value:"\ud83e\udde0 Purpose",id:"-purpose",level:2},{value:"\ud83d\udd27 API Methods",id:"-api-methods",level:3},{value:"\ud83c\udfd7\ufe0f Technical Specification",id:"\ufe0f-technical-specification",level:2},{value:"Return Type",id:"return-type",level:3},{value:"Interfaces",id:"interfaces",level:3},{value:"\u2705 Usage Examples",id:"-usage-examples",level:2},{value:"1. Basic Query",id:"1-basic-query",level:3},{value:"2. Running a Transaction",id:"2-running-a-transaction",level:3},{value:"\u26a0\ufe0f Critical Rules",id:"\ufe0f-critical-rules",level:2},{value:"\ud83d\ude80 Performance &amp; Reliability",id:"-performance--reliability",level:2}];function o(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"-supastash-database-adapter",children:"\ud83d\udce6 Supastash Database Adapter"})}),"\n",(0,i.jsxs)(n.p,{children:["Supastash utilizes a ",(0,i.jsx)(n.strong,{children:"pluggable SQLite adapter system"})," to support multiple SQLite engines, including ",(0,i.jsx)(n.code,{children:"Expo SQLite"}),", ",(0,i.jsx)(n.code,{children:"Nitro SQLite"}),", and ",(0,i.jsx)(n.code,{children:"react-native-sqlite-storage"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"getSupastashDb()"})," function serves as the ",(0,i.jsx)(n.strong,{children:"single entry point"})," for obtaining the active database connection, ensuring the library remains engine-agnostic and transaction-safe."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-purpose",children:"\ud83e\udde0 Purpose"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"getSupastashDb()"})," function returns a normalized ",(0,i.jsx)(n.code,{children:"SupastashSQLiteDatabase"})," instance designed to:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Wrap"})," the underlying SQLite engine."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Expose"})," a consistent API surface across different platforms."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Handle"})," transactions safely (auto-commit/rollback)."]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["[!IMPORTANT] > ",(0,i.jsx)(n.strong,{children:"Internal Rule:"})," Never interact directly with the raw SQLite client inside Supastash internals. Always use ",(0,i.jsx)(n.code,{children:"getSupastashDb()"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"-api-methods",children:"\ud83d\udd27 API Methods"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Method"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Returns"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"runAsync(sql, params?)"})}),(0,i.jsxs)(n.td,{children:["Executes a single statement (e.g., ",(0,i.jsx)(n.code,{children:"INSERT"}),", ",(0,i.jsx)(n.code,{children:"UPDATE"}),", ",(0,i.jsx)(n.code,{children:"DELETE"}),")"]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Promise<void>"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"getAllAsync(sql, params?)"})}),(0,i.jsxs)(n.td,{children:["Fetches ",(0,i.jsx)(n.strong,{children:"all rows"})," from a ",(0,i.jsx)(n.code,{children:"SELECT"})," query"]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Promise<any[]>"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"getFirstAsync(sql, params?)"})}),(0,i.jsxs)(n.td,{children:["Fetches the ",(0,i.jsx)(n.strong,{children:"first row only"})," (or ",(0,i.jsx)(n.code,{children:"null"})," if none) from a ",(0,i.jsx)(n.code,{children:"SELECT"})," query"]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Promise<any | null>"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"execAsync(statements)"})}),(0,i.jsxs)(n.td,{children:["Executes multiple SQL statements separated by ",(0,i.jsx)(n.code,{children:";"})," (typically used for schema creation or migrations)"]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Promise<void>"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"withTransaction(fn)"})}),(0,i.jsx)(n.td,{children:"Executes multiple operations inside a single SQLite transaction. Automatically commits on success and rolls back if an error is thrown. Nested transactions are not supported."}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Promise<T>"})})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-technical-specification",children:"\ud83c\udfd7\ufe0f Technical Specification"}),"\n",(0,i.jsx)(n.h3,{id:"return-type",children:"Return Type"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"Promise<SupastashSQLiteDatabase>"})}),"\n",(0,i.jsx)(n.h3,{id:"interfaces",children:"Interfaces"}),"\n",(0,i.jsx)(n.p,{children:"The database instance extends a base executor to provide transaction and lifecycle management."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface SupastashSQLiteDatabase extends SupastashSQLiteExecutor {\n  closeAsync(): Promise<void>;\n\n  withTransaction<T>(\n    fn: (tx: SupastashSQLiteExecutor) => Promise<T> | T\n  ): Promise<T>;\n}\n\ninterface SupastashSQLiteExecutor {\n  runAsync(sql: string, params?: readonly unknown[]): Promise<void>;\n  getAllAsync<T = any>(sql: string, params?: readonly unknown[]): Promise<T[]>;\n  getFirstAsync<T = any>(\n    sql: string,\n    params?: readonly unknown[]\n  ): Promise<T | null>;\n  execAsync(statements: string): Promise<void>;\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-usage-examples",children:"\u2705 Usage Examples"}),"\n",(0,i.jsx)(n.h3,{id:"1-basic-query",children:"1. Basic Query"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const db = await getSupastashDb();\n\nawait db.runAsync(\n  `INSERT INTO orders (id, customer_name, total_amount, created_at)\n   VALUES (?, ?, ?, ?)`,\n  ["1", "John Doe", 150, new Date().toISOString()]\n);\n'})}),"\n",(0,i.jsx)(n.h3,{id:"2-running-a-transaction",children:"2. Running a Transaction"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const db = await getSupastashDb();\n\nawait db.withTransaction(async (tx) => {\n  await tx.runAsync(\n    `INSERT INTO orders (id, customer_name, total_amount, created_at)\n     VALUES (?, ?, ?, ?)`,\n    ["1", "Jane", 200, new Date().toISOString()]\n  );\n\n  await tx.runAsync(\n    `INSERT INTO order_items (id, order_id, product_name, quantity, price)\n     VALUES (?, ?, ?, ?, ?)`,\n    ["10", "1", "Premium Shirt", 2, 100]\n  );\n});\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-critical-rules",children:"\u26a0\ufe0f Critical Rules"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Rule"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"No Nesting"})}),(0,i.jsxs)(n.td,{children:["Do not call ",(0,i.jsx)(n.code,{children:"db.withTransaction"})," inside another transaction block."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"No Mixing"})}),(0,i.jsxs)(n.td,{children:["Never use ",(0,i.jsx)(n.code,{children:"rawDb.execute()"})," alongside Supastash executors in the same block."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"No Manual Control"})}),(0,i.jsxs)(n.td,{children:["Do not manually call ",(0,i.jsx)(n.code,{children:"COMMIT"})," or ",(0,i.jsx)(n.code,{children:"ROLLBACK"}),". The adapter handles this."]})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-performance--reliability",children:"\ud83d\ude80 Performance & Reliability"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Batching:"})," Always batch writes inside a transaction. Without them, 10,000 inserts can be ",(0,i.jsx)(n.strong,{children:"10\u201350\xd7 slower"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>c});var t=s(6540);const i={},r=t.createContext(i);function a(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);